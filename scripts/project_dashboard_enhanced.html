<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAIA Enhanced Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e1e8ed;
            padding-bottom: 0;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #657786;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #f5f8fa;
            color: #1da1f2;
        }

        .nav-tab.active {
            background: #1da1f2;
            color: white;
            box-shadow: 0 2px 4px rgba(29, 161, 242, 0.3);
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .stat-card h3 {
            font-size: 0.9em;
            color: #657786;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #1da1f2;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: #657786;
            font-size: 0.9em;
        }

        .stat-card.success .value { color: #17bf63; }
        .stat-card.warning .value { color: #ffad1f; }
        .stat-card.danger .value { color: #e0245e; }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card h2 {
            margin-bottom: 20px;
            color: #14171a;
            font-size: 1.5em;
        }

        /* Kanban Board Styles */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .kanban-column {
            background: #f5f8fa;
            border-radius: 8px;
            padding: 15px;
            min-height: 400px;
        }

        .kanban-column h3 {
            margin-bottom: 15px;
            color: #14171a;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .column-count {
            background: #1da1f2;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.85em;
        }

        .kanban-card {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: move;
            transition: transform 0.2s;
        }

        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .kanban-card .task-id {
            font-weight: bold;
            color: #1da1f2;
            font-size: 0.9em;
        }

        .kanban-card .task-title {
            margin: 8px 0;
            color: #14171a;
        }

        /* Roadmap Styles */
        .roadmap-timeline {
            position: relative;
            padding: 20px 0;
        }

        .roadmap-milestone {
            position: relative;
            padding: 20px;
            margin-bottom: 30px;
            background: white;
            border-left: 4px solid #1da1f2;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .roadmap-milestone h3 {
            color: #14171a;
            margin-bottom: 10px;
        }

        .roadmap-date {
            color: #657786;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .roadmap-tasks {
            list-style: none;
            padding-left: 0;
        }

        .roadmap-tasks li {
            padding: 8px 0;
            border-bottom: 1px solid #e1e8ed;
        }

        .roadmap-tasks li:last-child {
            border-bottom: none;
        }

        /* Calendar Styles */
        .calendar-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header h3 {
            font-size: 1.3em;
            color: #14171a;
        }

        .calendar-nav button {
            background: #1da1f2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 0 5px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            color: #657786;
            padding: 10px;
            font-size: 0.9em;
        }

        .calendar-day {
            min-height: 100px;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            padding: 8px;
            background: white;
            transition: background 0.2s;
        }

        .calendar-day:hover {
            background: #f5f8fa;
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day-number {
            font-weight: bold;
            color: #14171a;
            margin-bottom: 5px;
        }

        .calendar-task {
            background: #1da1f2;
            color: white;
            font-size: 0.75em;
            padding: 3px 6px;
            border-radius: 3px;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Metrics Styles */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        /* Timeline Enhancements */
        .timeline-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .timeline-task-name {
            width: 200px;
            font-weight: 600;
            color: #14171a;
        }

        .timeline-bar-container {
            flex: 1;
            height: 30px;
            background: #e1e8ed;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .timeline-bar {
            height: 100%;
            background: linear-gradient(90deg, #1da1f2, #17bf63);
            border-radius: 15px;
            position: absolute;
            transition: width 0.3s;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge.status-completed { background: #d4edda; color: #155724; }
        .badge.status-pending { background: #fff3cd; color: #856404; }
        .badge.status-in-progress { background: #d1ecf1; color: #0c5460; }
        .badge.priority-critical { background: #f8d7da; color: #721c24; }
        .badge.priority-high { background: #fff3cd; color: #856404; }
        .badge.priority-medium { background: #d1ecf1; color: #0c5460; }
        .badge.priority-low { background: #e2e3e5; color: #383d41; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #657786;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .kanban-board {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .calendar-grid {
                gap: 5px;
            }

            header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ GAIA Enhanced Dashboard</h1>
            <p>Multi-View Project Management & Analytics</p>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchView('overview')">üìä Overview</button>
            <button class="nav-tab" onclick="switchView('kanban')">üìã Kanban</button>
            <button class="nav-tab" onclick="switchView('roadmap')">üó∫Ô∏è Roadmap</button>
            <button class="nav-tab" onclick="switchView('timeline')">üìà Timeline</button>
            <button class="nav-tab" onclick="switchView('calendar')">üìÖ Calendar</button>
            <button class="nav-tab" onclick="switchView('metrics')">üìä Metrics</button>
        </div>

        <!-- Overview View -->
        <div id="overview" class="view active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Tasks</h3>
                    <div class="value" id="total-tasks">-</div>
                    <div class="label">In Backlog</div>
                </div>
                <div class="stat-card success">
                    <h3>Completed</h3>
                    <div class="value" id="completed-tasks">-</div>
                    <div class="label">Tasks Done</div>
                </div>
                <div class="stat-card warning">
                    <h3>In Progress</h3>
                    <div class="value" id="inprogress-tasks">-</div>
                    <div class="label">Active Work</div>
                </div>
                <div class="stat-card danger">
                    <h3>Critical</h3>
                    <div class="value" id="critical-tasks">-</div>
                    <div class="label">High Priority</div>
                </div>
            </div>

            <div class="card">
                <h2>Overall Progress</h2>
                <div style="background: #e1e8ed; border-radius: 15px; height: 30px; overflow: hidden;">
                    <div id="overall-progress" style="height: 100%; background: linear-gradient(90deg, #1da1f2, #17bf63); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; width: 0%; transition: width 0.5s;">0%</div>
                </div>
                <p style="margin-top: 10px; color: #657786;">
                    <strong id="hours-completed">0</strong> / <strong id="hours-total">0</strong> estimated hours completed
                </p>
            </div>

            <div class="stats-grid">
                <div class="card">
                    <h2>By Priority</h2>
                    <div id="priority-breakdown"></div>
                </div>
                <div class="card">
                    <h2>By Status</h2>
                    <div id="status-breakdown"></div>
                </div>
            </div>
        </div>

        <!-- Kanban Board View -->
        <div id="kanban" class="view">
            <div class="card">
                <h2>Kanban Board</h2>
                <div class="kanban-board" id="kanban-board">
                    <div class="kanban-column" data-status="pending">
                        <h3>üìù Pending <span class="column-count" id="count-pending">0</span></h3>
                        <div class="kanban-cards" id="cards-pending"></div>
                    </div>
                    <div class="kanban-column" data-status="in-progress">
                        <h3>üöÄ In Progress <span class="column-count" id="count-in-progress">0</span></h3>
                        <div class="kanban-cards" id="cards-in-progress"></div>
                    </div>
                    <div class="kanban-column" data-status="completed">
                        <h3>‚úÖ Completed <span class="column-count" id="count-completed">0</span></h3>
                        <div class="kanban-cards" id="cards-completed"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Roadmap View -->
        <div id="roadmap" class="view">
            <div class="card">
                <h2>Project Roadmap</h2>
                <div class="roadmap-timeline" id="roadmap-timeline">
                    <div class="loading">Loading roadmap...</div>
                </div>
            </div>
        </div>

        <!-- Timeline View -->
        <div id="timeline" class="view">
            <div class="card">
                <h2>Gantt Timeline</h2>
                <div id="gantt-timeline"></div>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendar" class="view">
            <div class="card">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <h3 id="calendar-month">Month Year</h3>
                        <div class="calendar-nav">
                            <button onclick="changeMonth(-1)">‚Üê Previous</button>
                            <button onclick="changeMonth(0)">Today</button>
                            <button onclick="changeMonth(1)">Next ‚Üí</button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendar-grid"></div>
                </div>
            </div>
        </div>

        <!-- Metrics View -->
        <div id="metrics" class="view">
            <div class="metrics-grid">
                <div class="chart-card">
                    <h2>Task Completion Trend</h2>
                    <div class="chart-container">
                        <canvas id="completion-chart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h2>Priority Distribution</h2>
                    <div class="chart-container">
                        <canvas id="priority-chart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h2>Hours by Status</h2>
                    <div class="chart-container">
                        <canvas id="hours-chart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h2>Velocity Trend</h2>
                    <div class="chart-container">
                        <canvas id="velocity-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allTasks = [];
        let currentDate = new Date();

        // Switch between views
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(viewName).classList.add('active');
            event.target.classList.add('active');

            // Update view-specific content
            if (viewName === 'calendar') updateCalendar();
            if (viewName === 'roadmap') updateRoadmap();
            if (viewName === 'timeline') updateGanttTimeline();
            if (viewName === 'metrics') updateMetrics();
        }

        // Load data
        async function loadData() {
            try {
                const response = await fetch('/api/tasks');
                allTasks = await response.json();
                updateDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function updateDashboard() {
            updateOverview();
            updateKanban();
            updateCalendar();
            updateRoadmap();
            updateGanttTimeline();
            updateMetrics();
        }

        function updateOverview() {
            const total = allTasks.length;
            const completed = allTasks.filter(t => t.status === 'completed').length;
            const inProgress = allTasks.filter(t => t.status === 'in-progress').length;
            const critical = allTasks.filter(t => t.priority === 'critical').length;

            document.getElementById('total-tasks').textContent = total;
            document.getElementById('completed-tasks').textContent = completed;
            document.getElementById('inprogress-tasks').textContent = inProgress;
            document.getElementById('critical-tasks').textContent = critical;

            const totalHours = allTasks.reduce((sum, t) => sum + (t.est_hours || 0), 0);
            const completedHours = allTasks.filter(t => t.status === 'completed')
                .reduce((sum, t) => sum + (t.est_hours || 0), 0);
            
            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
            document.getElementById('overall-progress').style.width = progress + '%';
            document.getElementById('overall-progress').textContent = progress + '%';
            document.getElementById('hours-completed').textContent = completedHours.toFixed(1);
            document.getElementById('hours-total').textContent = totalHours.toFixed(1);

            // Priority breakdown
            const priorities = {critical: 0, high: 0, medium: 0, low: 0};
            allTasks.forEach(t => {
                const p = t.priority || 'medium';
                priorities[p] = (priorities[p] || 0) + 1;
            });

            document.getElementById('priority-breakdown').innerHTML = Object.entries(priorities)
                .map(([p, count]) => `
                    <div style="display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #e1e8ed;">
                        <span class="badge priority-${p}">${p}</span>
                        <strong>${count} tasks</strong>
                    </div>
                `).join('');

            // Status breakdown
            const statuses = {pending: 0, 'in-progress': 0, completed: 0};
            allTasks.forEach(t => {
                const s = t.status || 'pending';
                statuses[s] = (statuses[s] || 0) + 1;
            });

            document.getElementById('status-breakdown').innerHTML = Object.entries(statuses)
                .map(([s, count]) => `
                    <div style="display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #e1e8ed;">
                        <span class="badge status-${s}">${s}</span>
                        <strong>${count} tasks</strong>
                    </div>
                `).join('');
        }

        function updateKanban() {
            ['pending', 'in-progress', 'completed'].forEach(status => {
                const tasks = allTasks.filter(t => t.status === status);
                document.getElementById(`count-${status}`).textContent = tasks.length;
                
                const html = tasks.map(task => `
                    <div class="kanban-card">
                        <div class="task-id">${task.id}</div>
                        <div class="task-title">${task.title}</div>
                        <span class="badge priority-${task.priority || 'medium'}">${task.priority || 'medium'}</span>
                        ${task.est_hours ? `<div style="margin-top: 5px; color: #657786; font-size: 0.85em;">‚è±Ô∏è ${task.est_hours}h</div>` : ''}
                    </div>
                `).join('');
                
                document.getElementById(`cards-${status}`).innerHTML = html || '<p style="color: #657786;">No tasks</p>';
            });
        }

        function updateRoadmap() {
            // Group tasks by sprint or milestone
            const grouped = {};
            allTasks.forEach(task => {
                const sprint = task.sprint || task.milestone || 'Backlog';
                if (!grouped[sprint]) grouped[sprint] = [];
                grouped[sprint].push(task);
            });

            const html = Object.entries(grouped).map(([sprint, tasks]) => `
                <div class="roadmap-milestone">
                    <h3>${sprint}</h3>
                    <div class="roadmap-date">${tasks.length} tasks</div>
                    <ul class="roadmap-tasks">
                        ${tasks.map(t => `
                            <li>
                                <span class="badge status-${t.status}">${t.status}</span>
                                <strong>${t.id}</strong>: ${t.title}
                                <span class="badge priority-${t.priority || 'medium'}">${t.priority || 'medium'}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');

            document.getElementById('roadmap-timeline').innerHTML = html || '<p>No milestones defined</p>';
        }

        function updateGanttTimeline() {
            const html = allTasks.slice(0, 20).map(task => {
                const progress = task.progress || (task.status === 'completed' ? 100 : task.status === 'in-progress' ? 50 : 0);
                return `
                    <div class="timeline-row">
                        <div class="timeline-task-name">${task.id}: ${task.title.substring(0, 30)}...</div>
                        <div class="timeline-bar-container">
                            <div class="timeline-bar" style="width: ${progress}%"></div>
                        </div>
                        <span style="margin-left: 10px; color: #657786;">${progress}%</span>
                    </div>
                `;
            }).join('');

            document.getElementById('gantt-timeline').innerHTML = html || '<p>No tasks to display</p>';
        }

        function updateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('calendar-month').textContent = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            let html = '';
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });

            for (let i = 0; i < firstDay; i++) {
                html += '<div class="calendar-day other-month"></div>';
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const tasksForDay = allTasks.filter(t => {
                    const deadline = t.deadline || t.target_date;
                    if (!deadline) return false;
                    const taskDate = new Date(deadline);
                    return taskDate.getDate() === day && taskDate.getMonth() === month;
                });

                html += `
                    <div class="calendar-day">
                        <div class="calendar-day-number">${day}</div>
                        ${tasksForDay.slice(0, 3).map(t => 
                            `<div class="calendar-task" title="${t.title}">${t.id}</div>`
                        ).join('')}
                        ${tasksForDay.length > 3 ? `<div style="font-size: 0.75em; color: #657786;">+${tasksForDay.length - 3} more</div>` : ''}
                    </div>
                `;
            }

            document.getElementById('calendar-grid').innerHTML = html;
        }

        function changeMonth(delta) {
            if (delta === 0) {
                currentDate = new Date();
            } else {
                currentDate.setMonth(currentDate.getMonth() + delta);
            }
            updateCalendar();
        }

        function updateMetrics() {
            // Placeholder for chart implementations
            const chartIds = ['completion-chart', 'priority-chart', 'hours-chart', 'velocity-chart'];
            chartIds.forEach(id => {
                const canvas = document.getElementById(id);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    ctx.fillStyle = '#f5f8fa';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#657786';
                    ctx.font = '14px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('Chart visualization coming soon', canvas.width/2, canvas.height/2);
                }
            });
        }

        // Auto-refresh every 30 seconds
        setInterval(loadData, 30000);

        // Initial load
        loadData();
    </script>
</body>
</html>
